const game={isRunning:!0,isGameOver:!1,ai:!1,loader:!1,arrow:!1,settings:{worldWidth:1024,worldHeight:568,trees_max:3,init_gold:400,gold_per_tick:5,gold_per_tick_cooldown_default:150,gold_per_tick_cooldown:150},stage:{units:[],arrows:[],trees:[],clouds:[],castle:null,castle2:null},init(){game.canvas=document.getElementById("gamecanvas"),game.context=game.canvas.getContext("2d"),game.loader=loader,game.loader.init()},startGame(e=""){game.isGameOver=!1,game.castle=new Castle(game.loader.images.castle),game.castle2=new Castle2(game.loader.images.castle2),game.stage.units=[],game.stage.trees=[],game.stage.arrows=[],game.ai=!1,"onePlayer"===e&&(game.ai=new AI),game.changeGold(1,game.settings.init_gold),game.changeGold(2,game.settings.init_gold),game.settings.gold_per_tick_cooldown=game.settings.gold_per_tick_cooldown_default,game.stage.clouds.length||game.pushClouds(),document.querySelector(".ingame-menu").style.display="block",document.querySelector(".restart-button").style.display="block",game.drawingLoop()},drawingLoop(){game.clearCanvas(),game.ai&&game.ai.makeDecision(game.stage),game.stage.clouds.forEach((e,t)=>{e.render(e)}),game.castle.render(),game.castle2.render(),game.stage.trees.forEach((e,t)=>{e.render(e)});for(const e in game.stage.units){const t=game.stage.units[e];t.render(),t.action(),t.specialAction()}game.stage.arrows.forEach((e,t)=>{let a=game.stage.units[e.unit_id];void 0===a&&(a=!1),e.t<0&&(a&&(a.health-=e.damage),delete game.stage.arrows[t]),a&&a.health<=0&&(game.removeFightingWith(a.id),delete game.stage.units[a.id],a.shootingWith=[],a.speed=self.defaultSpeed),e.render()}),game.stage.trees.length<game.settings.trees_max&&game.stage.trees.push(new Tree(game.loader.images.tree)),game.isGameOver||(game.settings.gold_per_tick_cooldown--,game.settings.gold_per_tick_cooldown<=0&&(game.settings.gold_per_tick_cooldown=game.settings.gold_per_tick_cooldown_default,game.changeGold(1,game.settings.gold_per_tick),game.changeGold(2,game.settings.gold_per_tick))),game.isRunning&&requestAnimationFrame(game.drawingLoop)},gameOver(e){game.isGameOver=!0,game.ai=!1,game.stage.units=[],game.settings.gold_per_tick=5,e=1===e?"two":"one",document.querySelector(".game-results .result-data").textContent="Player "+e+" wins the game!",document.querySelector(".ingame-menu").style.display="none",game.showRestartButton(),game.hideButtons()},restartGame(){game.castle=!1,game.castle2=!1,game.isRunning=!0,game.stage.units=[],document.querySelector("#menu").style.display="block",document.querySelector(".restart-button").style.display="none",document.querySelector(".game-results").style.display="none",document.querySelector(".buttons").style.display="none"},hideButtons(){document.querySelector("#gamecontainer .buttons").style.display="none"},showRestartButton(){document.querySelector(".game-results").style.display="block",document.querySelector(".restart-button").style.display="block"},changeGold(e,t){1===e?game.castle.gold+=parseInt(t):game.castle2.gold+=parseInt(t)},checkGold(e,t){let a=game.castle.gold;return 2===e&&(a=game.castle2.gold),a>=t},hireUnit(e,t=1){e.player=t,2===t&&(e.defaultSpeed=-e.defaultSpeed,e.imageObj=game.loader.images.units_player2,e.x=900,e instanceof Archer&&(e.attackDistance=-e.attackDistance)),game.checkGold(e.player,e.cost)&&(game.stage.units[e.id]=e,game.changeGold(e.player,-e.cost))},pushClouds(){let e=[{x:600,y:50,width:255,height:76,speed:.05,pos:{x:0,y:0}},{x:0,y:100,width:198,height:75,speed:.1,pos:{x:0,y:76}},{x:400,y:200,width:173,height:52,speed:.2,pos:{x:0,y:151}}];for(let t of e)game.stage.clouds.push(new Clouds(t.x,t.y,t.width,t.height,t.speed,{x:t.pos.x,y:t.pos.y},game.loader.images.clouds))},generateUniqueId:()=>Math.floor(Date.now()/1e3)+Math.random().toString(36).substr(2,16),dealDamage(e,t){e.cooldownAttack>0?e.cooldownAttack--:(t.health-=e.damage,e.cooldownAttack=e.defaultCoolDownAttack)},removeFightingWith(e){for(let t in game.stage.units){let a=game.stage.units[t];for(let n in a.fightingWith){let o=a.fightingWith[n];if(e===o){let e=a.fightingWith.indexOf(o);-1!==e&&game.stage.units[t].fightingWith.splice(e,1)}}for(let n in a.shootingWith){e===a.shootingWith[n]&&(game.stage.units[t].shootingWith=[])}}},clearCanvas(){game.context.clearRect(0,0,game.canvas.width,game.canvas.height)}};window.addEventListener("load",()=>{game.init(),document.querySelector(".one_player_btn").onclick=(()=>{game.startGame("onePlayer"),document.getElementById("menu").style.display="none",document.getElementById("player-two-buttons").style.display="none",document.querySelector(".buttons").style.display="block"}),document.querySelector(".two_player_btn").onclick=(()=>{game.startGame("twoPlayers"),document.getElementById("player-two-buttons").style.display="initial",document.getElementById("menu").style.display="none",document.querySelector(".buttons").style.display="block"}),document.getElementById("button_01").onclick=(()=>{game.hireUnit(new Woodcutter)}),document.getElementById("button_02").onclick=(()=>{game.hireUnit(new Knight)}),document.getElementById("button_03").onclick=(()=>{game.hireUnit(new Archer)}),document.getElementById("button_04").onclick=(()=>{game.hireUnit(new Woodcutter,2)}),document.getElementById("button_05").onclick=(()=>{game.hireUnit(new Knight,2)}),document.getElementById("button_06").onclick=(()=>{game.hireUnit(new Archer,2)}),document.addEventListener("keydown",e=>{"KeyQ"===e.code&&document.getElementById("button_01").click(),"KeyW"===e.code&&document.getElementById("button_02").click(),"KeyE"===e.code&&document.getElementById("button_03").click(),"KeyA"===e.code&&document.getElementById("button_04").click(),"KeyS"===e.code&&document.getElementById("button_05").click(),"KeyD"===e.code&&document.getElementById("button_06").click()})});