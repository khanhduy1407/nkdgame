"use strict";let debugFrame=0,debugConsole=0,debugRects=[],debugConsoleTextArea,debugConsoleDisplayTextArea,downloadLink,debugCanvas=0;function DebugPrint(e){let a="-> "+e+"\n";a+=debugConsoleDisplayTextArea.value,debugConsoleDisplayTextArea.value=a}function ToggleDebugConsole(){(debugConsole=!debugConsole)?(debugConsoleTextArea.style.display="block",debugConsoleTextArea.focus()):mainCanvas.focus()}function DebugConsoleKeyDown(e){if(13!=e.keyCode)return;e.preventDefault();let v=debugConsoleTextArea.value,o="-> eval("+v+")\n";try{o+=eval(v)}catch(e){e instanceof Error?o+=e.message?"Error: "+e.message:e:o+="Unknown error"}o+="\n\n"+debugConsoleDisplayTextArea.value,debugConsoleTextArea.value="",debugConsoleDisplayTextArea.value=o}function InitDebug(){(debugConsoleTextArea=document.createElement("textarea")).style="height:30px;width:90%;display:none;color:#FFF;background-color:#000;",mainCanvas.before(debugConsoleTextArea),debugConsoleTextArea.onkeydown=(e=>DebugConsoleKeyDown(e)),(debugConsoleDisplayTextArea=document.createElement("textarea")).style="height:100px;width:90%;display:none;color:#FFF;background-color:#000;",mainCanvas.before(debugConsoleDisplayTextArea),(downloadLink=document.createElement("a")).display="none",downloadLink.before(debugConsoleTextArea),debugCanvas&&(document.body.style.overflow="visible",document.body.style.background="#400",mainCanvas.style.border="2px solid #F00",mainCanvas.style.width=mainCanvas.width+"px",mainCanvas.style.height=mainCanvas.height+"px",document.body.appendChild(levelCanvas),levelCanvas.style.border="2px solid #F00",levelCanvas.style.width=levelCanvas.width+"px",levelCanvas.style.height=levelCanvas.height+"px",levelCanvas.style.display="block",document.body.appendChild(tileMaskCanvas),tileMaskCanvas.style.border="2px solid #F00",tileMaskCanvas.style.width=tileMaskCanvas.width+"px",tileMaskCanvas.style.height=tileMaskCanvas.height+"px",tileMaskCanvas.style.display="block")}function DebugRect(e,a,o="#F00"){debug&&debugRects.push({pos:e.Clone(),size:a.Clone(),color:o.slice(0)})}function DebugPoint(e,a=.1,o="#F00"){debug&&DebugRect(e,new Vector2(a,a),o)}function RenderDebugRects(){function e(e,a,o){a.Multiply(tileSize);let n=e.Clone();n.Subtract(cameraPos),n.Multiply(tileSize),n.Subtract(a),n.Multiply(cameraScale),mainCanvasContext.strokeStyle=o,mainCanvasContext.save(),mainCanvasContext.translate(n.x+mainCanvas.width/2|0,n.y+mainCanvas.height/2|0),mainCanvasContext.scale(cameraScale,cameraScale),mainCanvasContext.strokeRect(0,0,2*a.x,2*a.y),mainCanvasContext.restore()}mainCanvasContext.lineWidth=1;for(let a of debugRects)e(a.pos,a.size,a.color);debugRects=[]}function UpdateDebug(){if(++debugFrame,UpdateDebugControls(),debugCollision){let e=tileSize*level.size;DebugRect(new Vector2(e/2,e/2),new Vector2(e/2,e/2),"#F00")}debugConsoleTextArea.style.display=debugConsole?"block":"none",debugConsoleDisplayTextArea.style.display=debugConsole?"block":"none",debug?RenderDebugRects():debugRects=[]}function UpdateDebugControls(){debug&&(KeyWasPressed(50)&&SaveSnapshot(),KeyWasPressed(51)&&(debugCollision=!debugCollision),KeyWasPressed(52)&&(debugParticles=!debugParticles),KeyWasPressed(53)&&(godMode=!godMode),KeyWasPressed(145)&&(debug=0),KeyWasPressed(71)&&(godMode=1)),KeyIsDown(70)&&KeyIsDown(82)&&KeyIsDown(65)&&KeyIsDown(78)&&KeyIsDown(75)&&(debug||PlaySound(4),debug=1)}function SaveSnapshot(){downloadLink.download="snapshot.png",downloadLink.href=mainCanvas.toDataURL("image/png").replace("image/png","image/octet-stream"),downloadLink.click()}