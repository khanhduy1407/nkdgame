var solution=[],initialBoard=[],currentBoard=[],numSolutions=0,selectedNumber=-1,selectedCell=-1;function newGame(){generateInitialBoard()}function getHint(){var e=getRandomEmptyCell(currentBoard);-1!=e&&(selectedNumber=solution[e],inputNumber(e))}function checkGame(){deselectNumber(),deselectCell(),$(".UserFilledButton").each(function(){var e=$(this).attr("id").match(/\d+/g);e=parseInt(e,10);var t=currentBoard[e];currentBoard[e]=0,valIsValid(t,e,currentBoard)||$(this).addClass("CellIncorrect"),currentBoard[e]=t})}function solveGame(){currentBoard=solution.slice(),updateBoard()}function resetGame(){currentBoard=initialBoard.slice(),updateBoard(),deselectNumber(),deselectCell()}function isBoardSolved(){for(var e=!0,t=0;t<81&&e;t++)currentBoard[t]!=solution[t]&&(e=!1);e&&($(".ModalWindow").css("display","block"),$(".container").css("opacity","0.2"))}function generateInitialBoard(){numSolutions=0,selectedNumber=-1,selectedCell=-1,generateFirstRow();for(var e=9;e<=81;e++)solution[e]=0;generateSolution(),generateInitialGame(),currentBoard=initialBoard.slice(),updateBoard()}function generateFirstRow(){var e=[1,2,3,4,5,6,7,8,9];shuffleRow(e);for(var t=0;t<9;t++)solution[t]=e[t]}function generateSolution(){var e=getEmptyCell(solution);if(-1==getEmptyCell(solution))return!0;for(var t=1;t<=9;t++)if(valIsValid(t,e,solution)){if(solution[e]=t,generateSolution())return!0;solution[e]=0}return!1}function getEmptyCell(){for(var e=0;e<81;e++)if(0==solution[e])return e;return-1}function generateInitialGame(){initialBoard=solution.slice();for(var e=[],t=0;t<81;t++)e[t]=t;shuffleRow(e);for(t=0;t<81;t++)initialBoard[e[t]]=0,numSolutions=0,solutionIsUnique(0)||(initialBoard[e[t]]=solution[e[t]])}function shuffleRow(e){for(var t=e.length-1;t>0;t--){var l=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[l],e[l]=r}return e}function solutionIsUnique(e){if(e>80)return 1==(numSolutions+=1);if(0==initialBoard[e]){for(var t=1;t<=9;t++)if(valIsValid(t,e,initialBoard)){if(initialBoard[e]=t,!solutionIsUnique(e+1))return initialBoard[e]=0,!1;initialBoard[e]=0}}else if(!solutionIsUnique(e+1))return!1;return!0}function updateBoard(){for(var e="",t=1;t<=81;t++)e+=generateCell(currentBoard[t-1],t);$(".SudokuBoard").html(e)}function generateCell(e,t){var l=!1;0==e?elementClass="EmptyButton":0!=initialBoard[t-1]?elementClass="InitialFilledButton":elementClass="UserFilledButton";var r='<a href="javascript: void(0)" class="'+elementClass+'" id="cell'+(t-1)+'" ';return t%3==0&&t%9!=0&&(r+='style="border-right-width: 5px;',l=!0),(t>18&&t<28||t>45&&t<55)&&(l||(r+='style="'),r+="border-bottom-width: 5px;",!0),r+='">'+e,r+="</a>"}function inputNumber(e){currentBoard[e]=selectedNumber,updateCell(e,selectedNumber),deselectNumber(),deselectCell(),$(".CellIncorrect").each(function(){var e=$(this).attr("id").match(/\d+/g);console.log(e),e=parseInt(e,10);var t=currentBoard[e];currentBoard[e]=0,valIsValid(t,e,currentBoard)&&$(".UserFilledButton.CellIncorrect").removeClass("CellIncorrect"),currentBoard[e]=t}),isBoardSolved()}function selectNumber(e){selectedNumber=e.match(/\d+/g),selectedNumber=parseInt(selectedNumber,10)}function deselectNumber(){$("#button"+selectedNumber).removeClass("NumberSelected"),selectedNumber=-1}function removeNumber(e){selectedNumber=0,inputNumber(e)}function selectCell(e){selectedCell=e.match(/\d+/g),selectedCell=parseInt(selectedCell,10)}function deselectCell(){$("#cell"+selectedCell).removeClass("CellSelected"),selectedCell=-1}function updateCell(e,t){var l="#cell"+e;$(l).text(t),0==t?($(l).removeClass("UserFilledButton CellIncorrect CellSelected"),$(l).addClass("EmptyButton")):($(l).removeClass("EmptyButton CellIncorrect CellSelected"),$(l).addClass("UserFilledButton"))}function getRandomEmptyCell(e){for(var t=[],l=0;l<81;l++)t[l]=l;shuffleRow(t);for(l=0;l<81;l++)if(0==e[t[l]])return t[l];return-1}function valIsValid(e,t,l){return!!(validInRow(e,t,l)&&validInCol(e,t,l)&&validInBox(e,t,l))}function validInRow(e,t,l){for(var r=9*Math.floor(t/9),n=9*Math.floor(t/9)+8,o=r;o<=n;o++)if(e==l[o])return!1;return!0}function validInCol(e,t,l){for(var r=t%9,n=r+72,o=r;o<=n;o+=9)if(e==l[o])return!1;return!0}function validInBox(e,t,l){var r=27*Math.floor(t/27),n=Math.floor((t-r)/3)%3;row1Start=0==n?r:1==n?r+3:r+6;for(var o=row1Start+2,i=row1Start+9,a=row1Start+11,u=row1Start+18,c=row1Start+20,s=row1Start;s<=o;s++)if(e==l[s])return!1;for(var d=i;d<=a;d++)if(e==l[d])return!1;for(var m=u;m<=c;m++)if(e==l[m])return!1;return!0}$(document).ready(function(){newGame(),$("#newGame").on("click",function(){newGame()}),$("#hint").on("click",function(){getHint()}),$("#check").on("click",function(){checkGame()}),$("#solve").on("click",function(){solveGame()}),$("#reset").on("click",function(){resetGame()}),$(".SudokuBoard").on("click",".EmptyButton, .UserFilledButton",function(){$(this).toggleClass("CellSelected"),$(this).hasClass("CellSelected")?(-1!=selectedCell&&$("#cell"+selectedCell).removeClass("CellSelected"),selectCell(this.id),selectedNumber>0?inputNumber(selectedCell):0==selectedNumber&&removeNumber(selectedCell)):deselectCell()}),$(".NumberButton").on("click",function(){$(this).toggleClass("NumberSelected"),$(this).hasClass("NumberSelected")?(-1!=selectedNumber&&$("#button"+selectedNumber).removeClass("NumberSelected"),selectNumber(this.id),selectedCell>=0&&inputNumber(selectedCell)):deselectNumber()}),$("#modalNewGame").on("click",function(){$(".ModalWindow").css("display","none"),$(".container").css("opacity","1"),newGame()}),$("#modalNoNewGame").on("click",function(){$(".ModalWindow").css("display","none"),$(".container").css("opacity","1")})});