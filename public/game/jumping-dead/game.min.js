const userKeys={LEFT:37,UP:38,RIGHT:39,DOWN:40,W:87,S:83,A:65,D:68,SPACE:32,P:80,M:77,C:67},specialKeys={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/break",20:"Caps lock",27:"Escape",32:"Space",33:"Page up",34:"Page down",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",91:"LeftwinKey",92:"RightwinKey",106:"Multiply",107:"Add",111:"Divide",187:"Equal",188:"Comma",189:"Dash",190:"Period",191:"Slash",192:"GraveAccent",219:"OpenBracket",220:"BackSlash",221:"CloseBraket",222:"SingleQuote"},LEVEL_ENEMIES=[[{name:"FloatingFish",width:44,height:36,y2:200},{name:"zombie",width:40,height:45,y2:205}],[{name:"FloatingFish",width:44,height:36,y2:200},{name:"BlackBlob",width:60,height:53,y2:197}],[{name:"FloatingFish",width:44,height:36,y2:200},{name:"SlidingSkull",width:60,height:50,y2:200}],[{name:"FloatingFish",width:44,height:36,y2:200},{name:"CyclopsCrab",width:60,height:37,y2:220}],[{name:"FloatingFish",width:44,height:36,y2:200},{name:"CyclopsCrab",width:60,height:37,y2:220},{name:"SpinningSword",width:80,height:14,y2:170},{name:"ScarletStabber",width:70,height:60,y2:185}]],LEVEL_PLAYER_CHARACTERS=[{name:"good_guy",x2:100,y2:120},{name:"good_girl",x2:100,y2:120},{name:"good_girl",x2:100,y2:120},{name:"good_guy",x2:100,y2:120},{name:"ninja",x2:390,y2:120}],LEVEL_CLOUDS=[{name:"cloud",width:60,height:34},{name:"cloud2",width:65,height:50},{name:"cloud3",width:60,height:40},{name:"cloud3",width:60,height:40},{name:"cloud3",width:60,height:40}],font="Share Tech Mono",totalLevels=5,coinWidth=40,LEVEL_COMPLETION_TIME=3e3,MAX_VARIABLES=Math.floor(LEVEL_COMPLETION_TIME/50),FLYING=0,WALKING=1,ROTATING=2,REVERSED=3;var audio,coinpickup,gameover,gamewon,jump,enemykilled,currentLevel,timeLeft,playerCharacter,background,background2,scoreBoard,coinScoreBoard,coinScoreBoardImg,coinScoreBoardSupImg,highscoreBoard,startArrow1,startArrow2,startArrow3,timeBoard,timeBoardImg,levelDisplay,flyUp=!1,flyCounter=0,collectedCoins=0,currentCoins=0,score=0,currentScore=0,backgroundDx=0,xPos=-5,coinRotationValue=0,switchArrow=0,enemyCharacters=[],coins=[],clouds=[],keysPressed={LEFT:!1,UP:!1,RIGHT:!1,DOWN:!1,P:!1,M:!1,W:!1,S:!1,A:!1,D:!1},gamePaused=!1,displayOptionsModal=!1,optionId="";let dir,musicMuted=!1,musicToggled=!1;var highscore=0;function KeyDown(e){var t;t=e.which,keysPressed[t]=!0,e.repeat||(displayOptionsModal?changeOption(t):((keysPressed[userKeys.DOWN]||keysPressed[userKeys.S])&&!1===playerCharacter.duckCooldown&&duck(),(keysPressed[userKeys.LEFT]||keysPressed[userKeys.A])&&!1===playerCharacter.leftCooldown&&(moveLeft(),playerCharacter.leftCooldown=!0),(keysPressed[userKeys.RIGHT]||keysPressed[userKeys.D])&&!1===playerCharacter.rightCooldown&&(moveRight(),playerCharacter.rightCooldown=!0),(keysPressed[userKeys.UP]||keysPressed[userKeys.W])&&playerCharacter.hitGround&&!1===playerCharacter.duckCooldown&&!1===playerCharacter.jumpCooldown&&moveUp(),keysPressed[userKeys.SPACE]&&restartGame(),keysPressed[userKeys.P]&&(keysPressed[userKeys.P]=!1,pauseGame()),keysPressed[userKeys.M]&&(keysPressed[userKeys.M]=!1,muteMusic()),keysPressed[userKeys.C]&&(keysPressed[userKeys.C]=!1,resumeGame())))}function muteMusic(){musicMuted=!musicMuted;var e=document.getElementById("audioButton");musicMuted?(e.src="Pictures/audioOff.png",gamePaused||displayOptionsModal?musicToggled=!1:audio.pause()):(e.src="Pictures/audioOn.png",gamePaused||displayOptionsModal?musicToggled=!0:audio.load()),updateSoundPng()}function pauseGame(){gamePaused=!gamePaused}function updateSoundPng(){document.getElementById("MImg").src=musicMuted?"Pictures/audioOff.png":"Pictures/audioOn.png"}function gameOptions(){displayOptionsModal=!displayOptionsModal}function dispMess(e,t){"SOUND"===t?muteMusic():(document.getElementById("mess").innerHTML='Press the key you want to use for "'+t+'"',optionId=e)}function changeOption(e){var t=String.fromCharCode(e);""===optionId||Object.values(userKeys).includes(e)?keysPressed[userKeys.M]&&"M"!==optionId?dispMess("M","SOUND"):document.getElementById("mess").innerHTML="You cannot use this key":48<=e&&e<=90?(document.getElementById(optionId).value=t,userKeys[optionId]=e):e in specialKeys&&(document.getElementById(optionId).value=specialKeys[e],userKeys[optionId]=e)}function updateBackgroundDx(){backgroundDx=keysPressed[userKeys.LEFT]||keysPressed[userKeys.A]?-5:keysPressed[userKeys.RIGHT]||keysPressed[userKeys.D]?5:0}function KeyUp(e){var t;switch(t=e.which,keysPressed[t]=!1,t){case userKeys.UP:case userKeys.W:playerCharacter.speedY+=playerCharacter.gravity,playerCharacter.jumpCooldown=!1;break;case userKeys.LEFT:case userKeys.A:keysPressed[userKeys.RIGHT]||keysPressed[userKeys.D]?moveRight():playerCharacter.speedX=0,playerCharacter.leftCooldown=!1;break;case userKeys.RIGHT:case userKeys.D:keysPressed[userKeys.LEFT]||keysPressed[userKeys.A]?moveLeft():playerCharacter.speedX=0,playerCharacter.rightCooldown=!1;break;case userKeys.DOWN:case userKeys.S:playerCharacter.hitGround&&!0===playerCharacter.duckCooldown&&(playerCharacter.height=2*playerCharacter.height,playerCharacter.duckCooldown=!1)}updateBackgroundDx()}function showInstructions(){gameArea.init(),(background=new Component).init(gameArea.canvas.width,gameArea.canvas.height,"Pictures/background_1.jpg",0,0,"image",WALKING,!0),document.getElementById("instructionsModal").style.display="block"}function initialize_game(){currentLevel=1,collectedCoins=0,currentCoins=0,score=0,currentScore=0;var e=document.getElementById("coinMessage"),t=document.getElementById("pointsMessage");if(e){var a=document.getElementById("levelTransitionModalContent");a.removeChild(e),a.removeChild(t)}(audio=document.getElementById("bgm")).autoplay=!0,audio.loop=!0,musicMuted||audio.load(),startLevel()}function startLevel(){flyUp=!1,flyCounter=0,dir=1,xPos=-5,playerCharacter=new Component;let e=LEVEL_PLAYER_CHARACTERS[currentLevel-1];playerCharacter.init(60,70,`Pictures/${e.name}.png`,e.x2,e.y2,"image",WALKING,void 0,e.name),playerCharacter.jumpCooldown=!1,playerCharacter.leftCooldown=!1,playerCharacter.rightCooldown=!1,playerCharacter.duckCooldown=!1,background=new Component,background2=new Component,background.init(gameArea.canvas.width,gameArea.canvas.height,`Pictures/background_${currentLevel}.jpg`,-50,0,"image",WALKING),background2.init(gameArea.canvas.width,gameArea.canvas.height,`Pictures/background_${currentLevel}_reverse.jpg`,850,0,"image",WALKING),(scoreBoard=new Component).init("20px",font,"black",250,40,"text",WALKING),(coinScoreBoard=new Component).init("20px",font,"black",450,40,"text",WALKING),(coinScoreBoardImg=new Component).init(22,22,"Pictures/coin.png",420,21,"image",WALKING),(coinScoreBoardSupImg=new Component).init(40,40,"Pictures/stars.png",412,10,"image",WALKING),(highscoreBoard=new Component).init("20px","Consolas","black",20,40,"text",WALKING),highscoreBoard.text="HIGHSCORE:"+highscore,startArrow1=new Component,startArrow2=new Component,startArrow3=new Component,startArrow1.init(90,70,"Pictures/blackArrow.png",60,125,"image",1),startArrow2.init(90,70,"Pictures/blackArrow.png",30,125,"image",1),startArrow3.init(90,70,"Pictures/blackArrow.png",0,125,"image",1),(timeBoard=new Component).init("20px",font,"black",830,40,"text",WALKING),(timeBoardImg=new Component).init(22,22,"Pictures/clock.png",800,21,"image",WALKING),(levelDisplay=new Component).init("20px",font,"black",670,40,"text",WALKING);for(let e=0;e<MAX_VARIABLES;e++){enemyCharacters[e]=new Component;var t=Math.floor(Math.random()*(e*(gameArea.canvas.width/2))+(gameArea.canvas.width/2*e+1.25*gameArea.canvas.width)),a=Math.floor(Math.random()*LEVEL_ENEMIES[currentLevel-1].length);let r=LEVEL_ENEMIES[currentLevel-1][a];a===REVERSED&&(t=Math.floor(Math.random()*(-e*(gameArea.canvas.width/2)))),enemyCharacters[e].init(r.width,r.height,`Pictures/${r.name}.png`,t,r.y2,"image",a)}for(let e=0;e<MAX_VARIABLES;e++){let t=Math.floor(Math.random()*(450*e-600)+1);clouds[e]=new Component;let a=LEVEL_CLOUDS[currentLevel-1];clouds[e].init(a.width,a.height,`Pictures/${a.name}.png`,t,40,"image",WALKING)}for(let e=0;e<MAX_VARIABLES;e++){let t=Math.floor((Math.random()+1)*gameArea.canvas.width+e*gameArea.canvas.width/2);var r=Math.floor(150*Math.random()+30);coins[e]=new Component,coins[e].init(coinWidth,coinWidth,"Pictures/coin.png",t,r,"image",WALKING)}gameArea.init(),gameArea.start()}var interval,gameArea={init:function(){this.canvas=document.getElementById("canvas"),this.canvas.width=900,this.canvas.height=400,this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0]),document.body.insertBefore(document.getElementById("banner"),document.body.childNodes[0]),this.time=0,this.bonusActiveTime=1500,this.coinScoreActiveTime=1500,this.coinScoreInterval=null},start:function(){this.frameNo=0,this.time=0;var e=document.getElementsByClassName("modal");for(let t=0;t<e.length;t++){e[t].style.display="none"}this.interval=setInterval(updateGameArea,20)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},stop:function(){clearInterval(this.interval)}};function Component(){this.init=function(e,t,a,r,i,o,s,n=!1,c){if(this.moveType=s,this.alive=!0,this.alive=!0,this.color=a,this.dataType=o,this.ctx=gameArea.context,"image"===o&&(this.image=new Image,this.image.src=this.color,this.image.width=e,this.image.height=t,c&&(this.imageMirror=new Image,this.imageMirror.src=`Pictures/${c}_left.png`,this.imageMirror.width=e,this.imageMirror.height=t),n)){var h=this.image,l=this.ctx;this.image.onload=function(){l.drawImage(h,this.x,this.y,this.width,this.height)}}this.width=e,this.initHeight=t,this.alpha=1,this.height=t,this.speedX=0,this.speedY=0,this.x=r,this.y=i,this.orignX=r,this.gravity=1.5,this.hitGround=!0,this.doubleJumpAllowed=!0,this.angle=0},this.update=function(){"image"===this.dataType?(this.ctx.globalAlpha=this.alpha,0!==this.angle?(this.ctx.save(),this.ctx.translate(this.x+this.width/2,this.y+this.height/2),this.ctx.rotate(this.angle),this.ctx.translate(-this.x-this.width/2,-this.y-this.height/2),this.ctx.drawImage(this.image,this.x,this.y,this.width,this.height),this.ctx.restore()):this.ctx.drawImage(this.image,this.x,this.y,this.width,this.height)):"text"===this.dataType?(this.ctx.font=this.width+" "+this.height,this.ctx.fillStyle=this.color,this.ctx.fillText(this.text,this.x,this.y)):(this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height))},this.moveBackgrounds=function(e){0<=xPos?(xPos+=backgroundDx,this.x-=backgroundDx,e.x-=backgroundDx):backgroundDx=0,this.x<=-900?this.x=900:e.x<=-900?e.x=900:900<=this.x?this.x=-900:900<=e.x?e.x=-900:900<Math.abs(this.x)+Math.abs(e.x)&&(Math.abs(e.x)<Math.abs(this.x)?this.x+=0<this.x?-5:5:e.x+=0<e.x?-5:5)},this.crashWith=function(e){var t=this.x,a=this.x+this.width,r=this.y,i=this.y+this.height,o=e.x,s=e.x+e.width,n=e.y,c=e.y+e.height,h=!0;return(i<n+10||r>c-20||a<o+15||t>s-15)&&(h=!1),h},this.jumpsOn=function(e){var t=this.y+this.height,a=this.x+this.width,r=e.x,i=e.x+e.width,o=e.y,s=!1;return t>o-5&&t<o+20&&a>r&&this.x<i&&(s=!0,moveUp("hit")),s},this.newPos=function(){this.y+=this.speedY,this.speedY+=this.gravity,this.x+=this.speedX,this.hitBottom()},this.hitBottom=function(){var e=gameArea.canvas.height-this.height-150;this.y>e&&(this.y=e,this.hitGround=!0,this.doubleJumpAllowed=!0)},this.setAlive=function(e){this.alive=e},this.isAlive=function(){return this.alive},this.setX=function(e){this.x=e},this.getX=function(){return this.x},this.getOrignX=function(){return this.orignX},this.getImgSrc=function(){return this.image.src},this.setSrc=function(e){this.image.src=e},this.rotation=function(){0===coinRotationValue?this.setSrc("Pictures/coin.png"):10===coinRotationValue?this.setSrc("Pictures/coin2.png"):20===coinRotationValue?this.setSrc("Pictures/coin3.png"):30===coinRotationValue&&this.setSrc("Pictures/coin4.png")},this.changeDir=function(e){dir!==e&&([playerCharacter.image,playerCharacter.imageMirror]=[playerCharacter.imageMirror,playerCharacter.image],dir=e)},this.coinDisappear=function(){this.y+=-2,this.alpha-=.03,this.alpha<0&&(this.alpha=0)}}function gameOver(){interval&&clearInterval(interval),highscore<score&&(highscore=score),document.getElementById("gameOverModal").style.display="block",(audio=document.getElementById("bgm")).pause(),musicMuted||((gameover=document.getElementById("gameover")).autoplay=!0,gameover.load())}function restartGame(){gameArea.stop(),initialize_game()}function gameComplete(){document.getElementById("gameCompleteModal").style.display="block",gameArea.stop(),highscore<score&&(highscore=score),musicMuted||((audio=document.getElementById("bgm")).pause(),(gamewon=document.getElementById("gamewon")).autoplay=!0,gamewon.load())}function correctCharacterPos(){playerCharacter.y<0&&(playerCharacter.speedY=0,playerCharacter.y=0),playerCharacter.x<0&&(playerCharacter.speedX=0,playerCharacter.x=0),playerCharacter.x>gameArea.canvas.width-playerCharacter.width&&(playerCharacter.speedX=0,playerCharacter.x=gameArea.canvas.width-playerCharacter.width),playerCharacter.y>gameArea.canvas.height-playerCharacter.height&&(playerCharacter.speedY=0,playerCharacter.y=gameArea.canvas.height-playerCharacter.height)}function flashScore(){"black"===scoreBoard.color?scoreBoard.color="white":scoreBoard.color="black",gameArea.bonusActiveTime>1200&&(scoreBoard.color="black",clearInterval(gameArea.bonusInterval)),gameArea.bonusActiveTime+=150}function flashCoinScore(){coinScoreBoardSupImg.update(),"black"===coinScoreBoard.color?(coinScoreBoard.color="white",coinScoreBoardSupImg.alpha=1):(coinScoreBoard.color="black",coinScoreBoardSupImg.alpha=0),gameArea.coinScoreActiveTime>1200&&(coinScoreBoard.color="black",coinScoreBoardSupImg.alpha=0,clearInterval(gameArea.coinScoreInterval)),gameArea.coinScoreActiveTime+=150}function flashStartArrow(){++switchArrow<30?(startArrow3.setSrc("Pictures/goldArrow.png"),startArrow2.setSrc("Pictures/blackArrow.png"),startArrow1.setSrc("Pictures/blackArrow.png")):switchArrow<60?(startArrow3.setSrc("Pictures/blackArrow.png"),startArrow2.setSrc("Pictures/goldArrow.png")):switchArrow<90?(startArrow2.setSrc("Pictures/blackArrow.png"),startArrow1.setSrc("Pictures/goldArrow.png")):switchArrow=0,startArrow1.setX(startArrow1.getOrignX()-xPos),startArrow2.setX(startArrow2.getOrignX()-xPos),startArrow3.setX(startArrow3.getOrignX()-xPos)}function updateGameArea(){let e=document.getElementById("gamePauseModal"),t=document.getElementById("optionsModal");if(gamePaused)return e.style.display="block",void(musicMuted||(audio.pause(),musicToggled=!0));if(displayOptionsModal)return t.style.display="block",void(musicMuted||(audio.pause(),musicToggled=!0));if(e.style.display="none",t.style.display="none",musicToggled&&(audio.load(),musicToggled=!1),gameArea.time>=LEVEL_COMPLETION_TIME)if(gameArea.stop(),currentLevel===totalLevels)gameComplete();else{currentLevel++,document.getElementById("levelTransitionModal").style.display="block";var a=document.getElementById("levelTransitionModalContent");a.innerHTML+=`<p id="coinMessage" class="levelTransitionMessage">Coin: ${currentCoins}</p>`,a.innerHTML+=`<p id="pointsMessage" class="levelTransitionMessage">Score: ${currentScore}</p>`}for(let e=0;e<enemyCharacters.length;e++)enemyCharacters[e].isAlive()&&(playerCharacter.jumpsOn(enemyCharacters[e])?(enemyCharacters[e].setAlive(!1),incrementScore(100*currentLevel),gameArea.bonusActiveTime=0,gameArea.bonusInterval=setInterval(flashScore,150),musicMuted||((enemykilled=document.getElementById("enemykilled")).autoplay=!0,enemykilled.load())):playerCharacter.crashWith(enemyCharacters[e])&&(backgroundDx=0,gameArea.stop(),gameOver()));++coinRotationValue>=40&&(coinRotationValue=0);for(let e=0;e<coins.length;e++)coins[e].isAlive()&&(playerCharacter.crashWith(coins[e])?(coins[e].setSrc("Pictures/stars.png"),collectedCoins++,currentCoins++,incrementScore(50*currentLevel),coins[e].setAlive(!1),gameArea.coinScoreActiveTime=0,gameArea.coinScoreInterval=setInterval(flashCoinScore,150),musicMuted||((coinpickup=document.getElementById("coinpickup")).autoplay=!0,coinpickup.load())):coins[e].rotation());if(gameArea.clear(),background.moveBackgrounds(background2),background.update(),background2.update(),5!==currentLevel)for(let e=0;e<clouds.length;e++)clouds[e].x+=.5-backgroundDx,clouds[e].update();scoreBoard.text="SCORE: "+score,scoreBoard.update(),coinScoreBoard.text=collectedCoins,coinScoreBoard.update(),coinScoreBoardImg.update(),highscoreBoard.update(),flashStartArrow(),startArrow1.update(),startArrow2.update(),startArrow3.update(),timeBoard.text=Math.ceil(timeLeft),timeBoard.update(),timeBoardImg.update(),incrementFrameNumber(2),incrementTime(2),levelDisplay.text="Level "+currentLevel,levelDisplay.update();for(let e=0;e<enemyCharacters.length;e++)enemyCharacters[e].update();for(let e=0;e<coins.length;e++)coins[e].update();playerCharacter.newPos(),correctCharacterPos(),playerCharacter.update(),35===flyCounter&&(flyUp=!flyUp,flyCounter=0),flyCounter++;for(let e=0;e<enemyCharacters.length;e++)enemyCharacters[e].isAlive()?(currentLevel>=3&&enemyCharacters[e].moveType!==FLYING?5===currentLevel&&enemyCharacters[e].moveType===REVERSED?enemyCharacters[e].x-=-4+backgroundDx:enemyCharacters[e].x+=-4-backgroundDx:enemyCharacters[e].x+=-2-backgroundDx,enemyCharacters[e].moveType===FLYING&&(enemyCharacters[e].y+=!0===flyUp?3:-3),enemyCharacters[e].moveType===ROTATING&&(enemyCharacters[e].angle+=10*Math.PI/180)):(enemyCharacters[e].height=enemyCharacters[e].initHeight/3,enemyCharacters[e].x-=backgroundDx,enemyCharacters[e].y+=10,enemyCharacters[e].alpha+=-.01,enemyCharacters[e].alpha<0&&(enemyCharacters[e].alpha=0),enemyCharacters[e].hitBottom());for(let e=0;e<coins.length;e++)coins[e].isAlive()?coins[e].x+=-2-backgroundDx:coins[e].coinDisappear()}function incrementFrameNumber(e){gameArea.frameNo+=e}function incrementScore(e){score+=e,currentScore+=e}function incrementTime(e){gameArea.time+=e,timeLeft=(LEVEL_COMPLETION_TIME-gameArea.time)/100}function stopMove(){playerCharacter.speedX=0,playerCharacter.speedY=0,playerCharacter.y<0&&(playerCharacter.speedY=0,playerCharacter.y=0),playerCharacter.x<0&&(playerCharacter.speedX=0,playerCharacter.x=0),playerCharacter.x>gameArea.canvas.width-playerCharacter.width&&(playerCharacter.speedX=0,playerCharacter.x=gameArea.canvas.width-playerCharacter.width)}function moveUp(e){"hit"===e?(playerCharacter.speedY>=-3?playerCharacter.speedY=-7:playerCharacter.speedY-=4,playerCharacter.hitGround=!1):playerCharacter.hitGround&&playerCharacter.y>=170?(playerCharacter.speedY=-20,playerCharacter.hitGround=!1,playerCharacter.jumpCooldown=!0,musicMuted||((jump=document.getElementById("jump")).autoplay=!0,jump.load())):!0===playerCharacter.doubleJumpAllowed&&(playerCharacter.speedY=-7,playerCharacter.doubleJumpAllowed=!1)}function moveLeft(){playerCharacter.changeDir(-1),backgroundDx=-5}function moveRight(){playerCharacter.changeDir(1),xPos<=-5&&(xPos=0,background.setX(-50),background2.setX(850)),backgroundDx=5}function duck(){playerCharacter.hitGround&&(playerCharacter.height=playerCharacter.height/2,playerCharacter.duckCooldown=!0)}function moveLeftMouse(){interval=setInterval(moveLeft,1),backgroundDx=-5}function moveRightMouse(){interval=setInterval(moveRight,1),xPos<=-5&&(xPos=0,background.setX(-50),background2.setX(850)),backgroundDx=5}function onMouseUp(){clearInterval(interval),stopMove(),backgroundDx=0}function duckMouseUp(){playerCharacter.hitGround&&!0===playerCharacter.duckCooldown&&(playerCharacter.height=2*playerCharacter.height,playerCharacter.duckCooldown=!1)}function resumeGame(){var e=document.getElementById("levelTransitionModal"),t=document.getElementById("levelTransitionModalContent");if("block"===e.style.display){var a=document.getElementById("coinMessage"),r=document.getElementById("pointsMessage");t.removeChild(a),t.removeChild(r),e.style.display="none",currentCoins=0,currentScore=0,startLevel()}}