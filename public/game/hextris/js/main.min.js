function scaleCanvas(){if(canvas.width=$(window).width(),canvas.height=$(window).height(),canvas.height>canvas.width?settings.scale=canvas.width/800*settings.baseScale:settings.scale=canvas.height/800*settings.baseScale,trueCanvas={width:canvas.width,height:canvas.height},window.devicePixelRatio){var e=$("#canvas").attr("width"),t=$("#canvas").attr("height");$("#canvas").attr("width",e*window.devicePixelRatio),$("#canvas").attr("height",t*window.devicePixelRatio),$("#canvas").css("width",e),$("#canvas").css("height",t),trueCanvas={width:e,height:t},ctx.scale(window.devicePixelRatio,window.devicePixelRatio)}setBottomContainer(),set_score_pos()}function setBottomContainer(){var e=$("#buttonCont").offset().top-(trueCanvas.height/2+100*settings.scale)-29;e<0&&$("#bottomContainer").css("margin-bottom","-"+Math.abs(e)+"px")}function set_score_pos(){$("#container").css("margin-top","0");var e=$("#container").height()/2+$("#container").offset().top,t=$("#buttonCont").offset().top,a=$("#highScoreInGameText"),i=(t+(a.offset().top+a[0].offsetHeight))/2-e;$("#container").css("margin-top",i+"px")}function toggleDevTools(){$("#devtools").toggle()}function resumeGame(){gameState=1,hideUIElements(),$("#pauseBtn").show(),$("#restartBtn").hide(),importing=0,startTime=Date.now(),setTimeout(function(){1!=gameState&&2!=gameState||$("#helpScreen").is(":visible")||$("#openSideBar").fadeOut(150,"linear")},7e3),checkVisualElements(0)}function checkVisualElements(e){e&&$("#openSideBar").is(":visible")&&$("#openSideBar").fadeOut(150,"linear"),$("#pauseBtn").is(":visible")||$("#pauseBtn").fadeIn(150,"linear"),$("#fork-ribbon").fadeOut(150),$("#restartBtn").is(":visible")||$("#restartBtn").fadeOut(150,"linear"),$("#buttonCont").is(":visible")&&$("#buttonCont").fadeOut(150,"linear")}function hideUIElements(){$("#pauseBtn").hide(),$("#restartBtn").hide(),$("#startBtn").hide()}function init(e){if(!settings.ending_block||1!=e){e&&($("#pauseBtn").attr("class","pause-game"),$("#helpScreen").is(":visible")&&$("#helpScreen").fadeOut(150,"linear"),setTimeout(function(){1==gameState&&$("#openSideBar").fadeOut(150,"linear"),infobuttonfading=!1},7e3),clearSaveState(),checkVisualElements(1)),0===highscores.length?$("#currentHighScore").text(0):$("#currentHighScore").text(highscores[0]),infobuttonfading=!0,$("#pauseBtn").attr("class","pause-game"),hideUIElements();var t,a,i=localStorage.getItem("saveState")||"{}";if(i=JSONfn.parse(i),document.getElementById("canvas").className="",history={},importedHistory=void 0,importing=0,score=i.score||0,prevScore=0,spawnLane=0,op=0,tweetblock=!1,scoreOpacity=0,gameState=1,$("#restartBtn").hide(),$("#pauseBtn").show(),void 0!==i.hex&&(gameState=1),settings.blockHeight=settings.baseBlockHeight*settings.scale,settings.hexWidth=settings.baseHexWidth*settings.scale,MainHex=i.hex||new Hex(settings.hexWidth),i.hex&&(MainHex.playThrough+=1),MainHex.sideLength=settings.hexWidth,i.blocks)for(i.blocks.map(function(e){rgbToHex[e.color]&&(e.color=rgbToHex[e.color])}),t=0;t<i.blocks.length;t++)a=i.blocks[t],blocks.push(a);else blocks=[];for(gdx=i.gdx||0,gdy=i.gdy||0,comboTime=i.comboTime||0,t=0;t<MainHex.blocks.length;t++)for(var n=0;n<MainHex.blocks[t].length;n++)MainHex.blocks[t][n].height=settings.blockHeight,MainHex.blocks[t][n].settled=0;MainHex.blocks.map(function(e){e.map(function(e){rgbToHex[e.color]&&(e.color=rgbToHex[e.color])})}),MainHex.y=-100,startTime=Date.now(),waveone=i.wavegen||new waveGen(MainHex),MainHex.texts=[],MainHex.delay=15,hideText()}}function addNewBlock(e,t,a,i,n){a*=settings.speedModifier,history[MainHex.ct]||(history[MainHex.ct]={}),history[MainHex.ct].block={blocklane:e,color:t,iter:a},i&&(history[MainHex.ct].distFromHex=i),n&&(blockHist[MainHex.ct].settled=n),blocks.push(new Block(e,t,a,i,n))}function exportHistory(){$("#devtoolsText").html(JSON.stringify(history)),toggleDevTools()}function setStartScreen(){$("#startBtn").show(),init(),isStateSaved()?importing=0:importing=1,$("#pauseBtn").hide(),$("#restartBtn").hide(),$("#startBtn").show(),gameState=0,requestAnimFrame(animLoop)}var spd=1;function animLoop(){switch(gameState){case 1:requestAnimFrame(animLoop),render();var e=((a=Date.now())-lastTime)/16.666*rush;if(spd>1&&(e*=spd),1==gameState&&(MainHex.delay?MainHex.delay--:update(e)),lastTime=a,checkGameOver()&&!importing){var t=localStorage.getItem("saveState")||"{}";t=JSONfn.parse(t),gameState=2,setTimeout(function(){enableRestart()},150),$("#helpScreen").is(":visible")&&$("#helpScreen").fadeOut(150,"linear"),$("#pauseBtn").is(":visible")&&$("#pauseBtn").fadeOut(150,"linear"),$("#restartBtn").is(":visible")&&$("#restartBtn").fadeOut(150,"linear"),$("#openSideBar").is(":visible")&&$(".openSideBar").fadeOut(150,"linear"),canRestart=0,clearSaveState()}break;case 0:case-1:requestAnimFrame(animLoop),render();break;case 2:var a;e=((a=Date.now())-lastTime)/16.666*rush;requestAnimFrame(animLoop),update(e),render(),lastTime=a;break;case 3:requestAnimFrame(animLoop),fadeOutObjectsOnScreen(),render();break;case 4:return setTimeout(function(){initialize(1)},1),void render();default:initialize(),setStartScreen()}1!=gameState&&2!=gameState&&(lastTime=Date.now())}function enableRestart(){canRestart=1}function isInfringing(e){for(var t=0;t<e.sides;t++){for(var a=0,i=0;i<e.blocks[t].length;i++)a+=e.blocks[t][i].deleted;if(e.blocks[t].length-a>settings.rows)return!0}return!1}function checkGameOver(){for(var e=0;e<MainHex.sides;e++)if(isInfringing(MainHex))return $.get("http://54.183.184.126/"+String(score)),-1==highscores.indexOf(score)&&highscores.push(score),writeHighScores(),gameOverDisplay(),!0;return!1}function showHelp(){"fa-arrow-left"==$("#openSideBar .fa-inverse").attr("class")?($("#openSideBar .fa-inverse").attr("class","fa-question"),0!=gameState&&-1!=gameState&&2!=gameState&&$("#fork-ribbon").fadeOut(150,"linear")):($("#openSideBar").attr("src","fa-arrow-left"),0==gameState&&-1==gameState&&2==gameState&&$("#fork-ribbon").fadeIn(150,"linear")),$("#inst_main_body").html("<div id = 'instructions_head'><b>HOW TO PLAY</b></div><p>The goal of \"Hextris\" is to prevent the colored blocks from leaving inside the outer gray hexagon.</p><p>"+("mobile"!=settings.platform?"Press the right and left arrow keys":"Tap the left and right side of the screen")+" to rotate the hexagon."+("mobile"!=settings.platform?" press down arrow to speed up block falling down":"")+" </p><p>Clear blocks and score points by making 3 or more tied blocks of the same color.</p><p>The time remaining before your Streak Combo disappears is indicated by <span style='color:#f1c40f;'>the</span> <span style='color:#e74c3c'>color</span> <span style='color:#3498db'>block</span> <span style='color:#2ecc71'>on</span> outside hexagon</p> <hr> <p id = 'afterhr'></p> Game created by <b style='text-decoration: underline;'>NKDuy</b><p id=\"copyright\"><script>$(\"#copyright\").html(\"&copy; \" + new Date().getFullYear() + \" NKDuy. All Rights Reserved.\");<\/script></p>"),1==gameState&&pause(),("pause-game"!=$("#pauseBtn").attr("class")||0==gameState||infobuttonfading)&&($("#openSideBar").fadeIn(150,"linear"),$("#helpScreen").fadeToggle(150,"linear"))}