class Minesweeper{constructor({el:t,width:e,height:i,level:o,bombImageEl:l}){this.canvas=t,this.ctx=t.getContext("2d"),this.canvas.width=e,this.blocks=[],this.canvas.height=i,this.level=o,this.gameOver=!1,this.firstClick=!1,this.bombImage=l,this.difficultlies={easy:{mines_count:10,block_count_x:10,block_count_y:10,no_mines_radius:4},medium:{mines_count:40,block_count_x:18,block_count_y:15,no_mines_radius:5},hard:{mines_count:99,block_count_x:24,block_count_y:20,no_mines_radius:5}},this.blockSettings={width:e/this.difficultlies[o].block_count_x,height:i/this.difficultlies[o].block_count_y,color1:"#aad751",color2:"#a2d149",hoverColor:"rgba(85, 239, 196,0.5)"},this.initBoard(),this.mouseEvent()}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw(),requestAnimationFrame(()=>{this.render()})}initBoard(){let t=this.difficultlies[this.level];for(var e=0;e<t.block_count_y;e++){this.blocks.push([]);for(var i=0;i<t.block_count_x;i++){let t,o=this.blockSettings.width*i,l=this.blockSettings.height*e;e%2==1?t=i%2==0?this.blockSettings.color1:this.blockSettings.color2:e%2==0&&(t=i%2==0?this.blockSettings.color2:this.blockSettings.color1),this.blocks[e].push({color:t,x:o,y:l,status:!1,hover:!1,content:"",revealed:!1})}}console.log(this.blocks)}draw(){console.log(this.gameOver),this.blocks.forEach((t,e)=>{t.forEach((t,i)=>{"mine"==t.content&&1==this.gameOver?(this.ctx.fillStyle="rgba(214, 48, 49,0.2)",this.ctx.fillRect(t.x,t.y,this.blockSettings.width,this.blockSettings.height),this.ctx.drawImage(this.bombImage,t.x,t.y,this.blockSettings.width,this.blockSettings.height)):Number.isInteger(t.content)&&t.revealed?(this.ctx.fillStyle=e%2==0&&i%2==1||i%2==0&&e%2==1?"#e5c29f":"#d7b899",this.ctx.fillRect(t.x,t.y,this.blockSettings.width,this.blockSettings.height),0!==t.content&&(this.ctx.fillStyle="#fff",this.ctx.font="30px Arial",this.ctx.fillText(t.content,t.x+this.blockSettings.width/2-this.ctx.measureText(t.content).width/2,t.y+this.blockSettings.height/2+10))):(this.ctx.fillStyle=t.hover&&!t.revealed?this.blockSettings.hoverColor:t.color,this.ctx.fillRect(t.x,t.y,this.blockSettings.width,this.blockSettings.height))})}),this.generateNumbers()}generateMines(t,e){let i=this.difficultlies[this.level].mines_count,o=1;for(;o<=i;){let i=this.getRandomBlock();i.rowIndex==t&&i.colIndex==e||(this.blocks[i.rowIndex][i.colIndex].content="mine",o++)}}generateNumbers(){this.blocks.forEach((t,e)=>{t.forEach((t,i)=>{if("mine"==t.content)return;let o=0,l={top:[-1,0],bottom:[1,0],left:[0,-1],right:[0,1],topRight:[-1,1],topLeft:[-1,-1],bottomRight:[1,1],bottomLeft:[1,-1]};for(let t in l){let s=this.difficultlies[this.level].block_count_x-1,n=this.difficultlies[this.level].block_count_y-1;"top"==t&&0==e||("left"==t&&0==i||"right"==t&&i==s||"bottom"==t&&e==n||("topRight"!=t||0!=e&&i!=s)&&("topLeft"!=t||0!=e&&0!=i)&&("bottomRight"!=t||e!=n&&i!=s)&&("bottomLeft"!=t||e!=n&&0!=i)&&"mine"==this.blocks[e+l[t][0]][i+l[t][1]].content&&o++)}t.content=o})})}getRandomBlock(){let t=Math.floor(Math.random()*this.blocks.length);return{rowIndex:t,colIndex:Math.floor(Math.random()*this.blocks[t].length)}}go(t,e,i,o=!1){let l={top:[-1,0],bottom:[1,0],left:[0,-1],right:[0,1],topRight:[-1,1],topLeft:[-1,-1],bottomRight:[1,1],bottomLeft:[1,-1]};if(null==this.blocks[t])return;this.blocks[t][e].revealed="mine"!=this.blocks[t][e].content;let s=this.difficultlies[this.level].no_mines_radius;for(let o in l){let n=t+l[o][0],c=e+l[o][1],h=this.difficultlies[this.level].block_count_x-1,r=this.difficultlies[this.level].block_count_y-1;if("top"==o&&0==t)continue;if("left"==o&&0==e)continue;if("right"==o&&e==h)continue;if("bottom"==o&&t==r)continue;if("topRight"==o&&(0==t||e==h))continue;if("topLeft"==o&&(0==t||0==e))continue;if("bottomRight"==o&&(t==r||e==h))continue;if("bottomLeft"==o&&(t==r||0==e))continue;let a=this.blocks[t+l[o][0]][e+l[o][1]];if(n<0||n>r||c<0||c>h)return;if(!a.revealed&&"mine"!=a.content)if(!a.revealed&&Number.isInteger(a.content))a.revealed=!0;else{if(!(i<s))return;this.go(n,c,i++)}}}mouseEvent(){let t=this;this.canvas.addEventListener("mousemove",function(e){let i=t.canvas.getBoundingClientRect(),o=e.clientX-i.left,l=e.clientY-i.top;t.blocks.forEach((e,i)=>{e.forEach((e,s)=>{0==e.status&&o>=e.x&&o<=e.x+t.blockSettings.width&&l>=e.y&&l<=e.y+t.blockSettings.height?t.blocks[i][s].hover=!0:t.blocks[i][s].hover=!1})})}),this.canvas.addEventListener("click",function(e){let i=t.canvas.getBoundingClientRect(),o=e.clientX-i.left,l=e.clientY-i.top;t.blocks.forEach((e,i)=>{e.forEach((e,s)=>{if(0==e.status&&o>=e.x&&o<=e.x+t.blockSettings.width&&l>=e.y&&l<=e.y+t.blockSettings.height&&0==t.blocks[i][s].revealed){if(this.firstClick){if("mine"==t.blocks[i][s].content)return t.gameOver=!0,console.log(this.gameOver),void alert("You hit the bomb!");t.go(i,s,0,!1),t.checkWin()}else t.generateMines(i,s),t.go(i,s,0,!0),this.firstClick=!0;console.log("clicked at ",e)}})})})}checkWin(){let t=this.blocks.filter(t=>!t.every(t=>t.revealed&&"mine"!==t.content||!t.revealed&&"mine"==t.content));console.log(t),0==t.length&&alert("You won this game!!!")}}